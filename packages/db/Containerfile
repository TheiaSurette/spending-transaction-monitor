# Containerfile
FROM python:3.12-alpine

# Install deps
RUN apk add --no-cache gcc musl-dev libpq-dev

# Copy db package
WORKDIR /app
COPY packages/db /app/packages/db

# Install uv + deps
RUN pip install uv
RUN uv venv /app/venv
ENV PATH="/app/venv/bin:$PATH"
RUN uv pip install -e ./packages/db

# Default command will be overridden by docker-compose
CMD ["alembic", "upgrade", "head"]
